) %>%
group_by(newID, wardType, id) %>%
summarise(#n_contacts = n()
n_contacts = length(unique(other_id))
# , dur_mins = mean(dur_mins)
, pInfPerContact = mean(pInfPerContact_excl)
, .groups = "keep") %>%
left_join(timespent %>%
group_by(id) %>%
summarise(total_mins = sum(total_mins))
, by = "id") %>%
mutate(contacts_per_hour = n_contacts/(total_mins/60)) %>%
# mutate(prod = contacts_per_hour*ifelse(is.na(dur_mins), 0, dur_mins)) %>%
group_by(newID, wardType) %>%
summarise_at(c("n_contacts", "contacts_per_hour", "pInfPerContact"
# , "dur_mins", "prod"
), ~mean(.x, na.rm = T)) %>%
ungroup %>%
left_join(ward_hours2 %>% select(newID, Hbar)
, by = "newID") %>%
mutate(daily_risk = pInfPerContact*contacts_per_hour*Hbar)
if(is.null(DR_excl)){
DR_excl <- DR_this %>% transmute(newID, wardType, excl, combcat = this_combcat
, w_nIDs = w_nIDs
, supposed_to_exclude = ifelse(excl == "none", 0, n_to_exclude)
, n_excluded = n_excluded
, pInfPerContact, contacts_per_hour, Hbar, daily_risk)
} else {
DR_excl <- rbind(DR_excl
, DR_this %>% transmute(newID, wardType, excl, combcat = this_combcat
, w_nIDs = w_nIDs
, supposed_to_exclude = ifelse(excl == "none", 0, n_to_exclude)
, n_excluded = n_excluded
, pInfPerContact, contacts_per_hour, Hbar, daily_risk)      )
}
}
}
}
write_csv(DR_excl, "output/DR_excl.csv")
} else {
DR_excl <- read_csv("output/DR_excl.csv")
}
DR_excl <- DR_excl %>%
{bind_rows(filter(., substr(excl, start = 1, stop = 3) != "ran")
, filter(., substr(excl, start = 1, stop = 3) == "ran") %>%
group_by(newID, wardType, combcat) %>%
summarise_if(is.numeric, mean) %>%
mutate(excl = "rand"))} %>%
arrange(newID, excl, combcat) %>%
mutate(excludeby = case_when(excl == "none" ~ "No exclusion"
# , excl == "rand1" ~ "rand1"
# , excl == "rand2" ~ "rand2"
# , excl == "rand3" ~ "rand3"
, excl == "rand" ~ "Random"
, excl == "deg" ~ "Degree"
, excl == "btw" ~ "Betweenness"
, excl == "cls" ~ "Closeness"
, excl == "dur" ~ "Contact hours")) %>%
mutate(excludeby = factor(excludeby, levels = c("No exclusion"
, "Random"
, "Degree", "Closeness", "Betweenness", "Contact hours"))) %>%
mutate(wardTypeCombine = case_when(wardType %in%  c("Medical ICU", "Surgical ICU") ~ "Adult ICU"
, wardType == "Infectious Diseases" ~ "Infectious diseases"
, T ~ wardType)
) %>%
mutate(wardTypeCombine = wardTypeCombine %>% factor %>% fct_infreq)
# proportional change for each
DR_pctChange <- DR_excl %>%
select(newID, wardTypeCombine, excludeby, combcat, daily_risk, supposed_to_exclude, n_excluded) %>%
{left_join(filter(., excludeby == "No exclusion") %>% rename(DR_baseline = daily_risk) %>% select(-excludeby, -n_excluded, -supposed_to_exclude)
, filter(., excludeby != "No exclusion"))} %>%
# filter(supposed_to_exclude == n_excluded) %>% #excludes any rows where there were not enough individuals to exclude
mutate(DR_ratio = daily_risk/DR_baseline
, DR_reduction = (DR_baseline - daily_risk)/DR_baseline
, reduction_per_person = DR_reduction/n_excluded)
#### average change across all wards
DR_pctChange_itt_bar = DR_pctChange %>%
# R0_pctChange_cat_itt_bar = R0_changeVsRandom_cat %>%
# filter(supposed_to_exclude == n_excluded) %>%
group_by(excludeby, combcat) %>%
summarise(median_DR_ratio = median(DR_ratio)
, median_DR_reduction = median(DR_reduction))
# create plot
redDARplot_4status <-
DR_pctChange %>% left_join(DR_pctChange_itt_bar) %>%
# filter(excludeby %in% c("Random", "Degree", "Contact hours")) %>%
filter(excludeby %in% c("Degree", "Contact hours")) %>%
mutate(combcat = factor(combcat, levels = c("Patient", "Visitor", "HCW", "All"))) %>%
filter(!is.na(combcat)) %>%
mutate(excludeby = fct_recode(excludeby
, `Total\ncontact hours` = "Contact hours"
, `Total\ndistinct contacts` = "Degree"
)) %>%
ggplot(aes(x = excludeby, colour = newID)) +
geom_jitter(aes(y = DR_reduction, shape = wardTypeCombine),  width = 0.2) +
# geom_jitter(aes(y = DR_reduction, shape = clusterAjmal),  width = 0.2) +
geom_crossbar(aes(y = median_DR_reduction
, ymin = median_DR_reduction
, ymax = median_DR_reduction
)
, size=0.5,col="red", width = .5) +
# facet_grid(which_row~factor(combcat, levels = combcats), drop = T) +
facet_wrap(.~combcat) +
theme_bw() +
theme(legend.background = element_rect(linetype = 1, size = 0.5, colour = 1)
# , axis.title.x = element_text(hjust = 0.1)
) +
guides(colour = F) +
theme(strip.background = element_rect(fill = NA)) +
scale_y_continuous(labels = function(x) scales::percent(x, accuracy = 1)) +
scale_shape_manual(values = c(`Neonatal ICU`=15,`General paediatrics`=16,`Paediatric emergency`=17
, `Adult ICU`=0,`Internal medicine`=1,`Adult emergency`=2
, `Infectious diseases`=3,`Geriatry`=4,`Pneumology`=5)) +
# scale_shape_manual(values = c(`Neonatal ICU`=3,`General paediatrics`=5,`Paediatric emergency`=2
#                               , `Adult ICU`=0,`Internal medicine`=16,`Adult emergency`=4
#                               , `Infectious diseases`=1,`Geriatry`=15,`Pneumology`=17)) +
labs(y = "Reduction in number of secondary infections per day per infected individual", x = "High risk individuals targeted by..."
# , caption = expression(frac(DAR[baseline]-DAR,DAR[baseline]))
, shape = "Ward type") #+
# coord_cartesian(ylim = c(0, NA))
redDARplot_4status
ggsave(plot = redDARplot_4status, "output/Fig_DARreduction.jpg", device = "jpeg"
, width = 20, height = 15, units = "cm", dpi = 600)
ggsave(plot = redDARplot_4status, "output/Fig_DARreduction.pdf", device = "pdf"
, width = 20, height = 15, units = "cm")
DR_pctChange_itt_bar
redDARplot_barReduction_plotdata <-
DR_pctChange %>% left_join(DR_pctChange_itt_bar) %>%
# filter(excludeby %in% c("Random", "Degree", "Contact hours")) %>%
mutate(newID = factor(newID, levels = Label_tib$newID)) %>%
filter(excludeby %in% c("Degree", "Contact hours"
# , "Random"
)) %>%
mutate(combcat = factor(combcat, levels = c("All", "HCW", "Patient", "Visitor"))) %>%
filter(!is.na(combcat)) %>%
mutate(excludeby = fct_recode(excludeby
, `Total contact hours` = "Contact hours"
, `Total distinct contacts` = "Degree"
# , `At random` = "Random"
))
# ward labels
Label_tib <- read_csv("input/newID_order.csv")
DR_pctChange_itt_bar
redDARplot_barReduction_plotdata <-
DR_pctChange %>% left_join(DR_pctChange_itt_bar) %>%
# filter(excludeby %in% c("Random", "Degree", "Contact hours")) %>%
mutate(newID = factor(newID, levels = Label_tib$newID)) %>%
filter(excludeby %in% c("Degree", "Contact hours"
# , "Random"
)) %>%
mutate(combcat = factor(combcat, levels = c("All", "HCW", "Patient", "Visitor"))) %>%
filter(!is.na(combcat)) %>%
mutate(excludeby = fct_recode(excludeby
, `Total contact hours` = "Contact hours"
, `Total distinct contacts` = "Degree"
# , `At random` = "Random"
))
redDARplot_barReduction <- redDARplot_barReduction_plotdata %>%
ggplot() +
# geom_jitter(aes(y = DR_reduction, shape = wardTypeCombine),  width = 0.2) +
geom_bar(aes(x = newID, y = DR_reduction), stat = "identity", position = position_dodge(width=0.8), width = 0.8) +
# geom_jitter(aes(y = DR_reduction, shape = clusterAjmal),  width = 0.2) +
geom_crossbar(data = redDARplot_barReduction_plotdata %>%
select(combcat, excludeby, median_DR_reduction) %>%
unique
, aes(x = "Geriatry #1"
, y = median_DR_reduction
, ymin = median_DR_reduction
, ymax = median_DR_reduction
), size=0.2,col="red", width = 10, alpha = 0.8) +
geom_text(data = redDARplot_barReduction_plotdata %>%
select(combcat, excludeby, median_DR_reduction) %>%
unique
, aes(x = "Geriatry #1"
, y = median_DR_reduction
, label = paste0(round(median_DR_reduction*100), "%"))
, nudge_y = 0.05
, colour = "red"
, size = 3) +
# facet_grid(which_row~factor(combcat, levels = combcats), drop = T) +
facet_nested_wrap(.~excludeby + combcat, nrow = 2) +
theme_bw() +
theme(legend.background = element_rect(linetype = 1, size = 0.5, colour = 1)
, axis.text.x = element_text(angle = 45, hjust = 1)
# , axis.title.x = element_text(hjust = 0.1)
) +
guides(colour = F) +
theme(strip.background = element_rect(fill = NA)
, axis.text.x = element_text(size = 6)) +
scale_y_continuous(labels = function(x) scales::percent(x, accuracy = 1)) +
# scale_shape_manual(values = c(`Neonatal ICU`=15,`General paediatrics`=16,`Paediatric emergency`=17
#                               , `Adult ICU`=0,`Internal medicine`=1,`Adult emergency`=2
#                               , `Infectious diseases`=3,`Geriatry`=4,`Pneumology`=5)) +
# scale_shape_manual(values = c(`Neonatal ICU`=3,`General paediatrics`=5,`Paediatric emergency`=2
#                               , `Adult ICU`=0,`Internal medicine`=16,`Adult emergency`=4
#                               , `Infectious diseases`=1,`Geriatry`=15,`Pneumology`=17)) +
labs(y = "Reduction in number of secondary infections\nper day per infected individual"
# , x = "High risk individuals targeted by..."
, x = ""
# , caption = expression(frac(DAR[baseline]-DAR,DAR[baseline]))
# , shape = "Ward type"
) #+
redDARplot_barReduction
library(ggh4x)
redDARplot_barReduction
redDARplot_barReduction <- redDARplot_barReduction_plotdata %>%
ggplot() +
# geom_jitter(aes(y = DR_reduction, shape = wardTypeCombine),  width = 0.2) +
geom_bar(aes(x = newID, y = DR_reduction), stat = "identity", position = position_dodge(width=0.8), width = 0.8) +
# geom_jitter(aes(y = DR_reduction, shape = clusterAjmal),  width = 0.2) +
geom_crossbar(data = redDARplot_barReduction_plotdata %>%
select(combcat, excludeby, median_DR_reduction) %>%
unique
, aes(x = "Geriatry #1"
, y = median_DR_reduction
, ymin = median_DR_reduction
, ymax = median_DR_reduction
), size=0.2,col="red", width = 10, alpha = 0.8) +
geom_text(data = redDARplot_barReduction_plotdata %>%
select(combcat, excludeby, median_DR_reduction) %>%
unique
, aes(x = "Geriatry #1"
, y = median_DR_reduction
, label = paste0(round(median_DR_reduction*100), "%"))
, nudge_y = 0.05
, colour = "red"
, size = 3) +
# facet_grid(which_row~factor(combcat, levels = combcats), drop = T) +
facet_nested_wrap(.~excludeby + combcat, nrow = 2) +
theme_bw() +
theme(legend.background = element_rect(linetype = 1, size = 0.5, colour = 1)
, axis.text.x = element_text(angle = 45, hjust = 1)
# , axis.title.x = element_text(hjust = 0.1)
) +
guides(colour = F) +
theme(strip.background = element_rect(fill = NA)
, axis.text.x = element_text(size = 6)) +
scale_y_continuous(labels = function(x) scales::percent(x, accuracy = 1)) +
# scale_shape_manual(values = c(`Neonatal ICU`=15,`General paediatrics`=16,`Paediatric emergency`=17
#                               , `Adult ICU`=0,`Internal medicine`=1,`Adult emergency`=2
#                               , `Infectious diseases`=3,`Geriatry`=4,`Pneumology`=5)) +
# scale_shape_manual(values = c(`Neonatal ICU`=3,`General paediatrics`=5,`Paediatric emergency`=2
#                               , `Adult ICU`=0,`Internal medicine`=16,`Adult emergency`=4
#                               , `Infectious diseases`=1,`Geriatry`=15,`Pneumology`=17)) +
labs(y = "Reduction in number of secondary infections\nper day per infected individual"
# , x = "High risk individuals targeted by..."
, x = ""
# , caption = expression(frac(DAR[baseline]-DAR,DAR[baseline]))
# , shape = "Ward type"
) #+
redDARplot_barReduction
redDARplot_barReduction
# coord_cartesian(ylim = c(0, NA))
ggsave(plot = redDARplot_barReduction, "output/redDARplot_barReduction.pdf", device = "pdf"
, width = 30, height = 15, units = "cm")
redDARplot_barReduction <- redDARplot_barReduction_plotdata %>%
ggplot() +
# geom_bar(aes(x = newID, y = DR_reduction), stat = "identity", position = position_dodge(width=0.8), width = 0.8) +
geom_segment(aes(x = newID, ymin = 0, ymax = DR_reduction)) +
geom_point(aes(x = newID, y = DR_reduction)) +
geom_crossbar(data = redDARplot_barReduction_plotdata %>%
select(combcat, excludeby, median_DR_reduction) %>%
unique
, aes(x = "Geriatry #1"
, y = median_DR_reduction
, ymin = median_DR_reduction
, ymax = median_DR_reduction
), size=0.2,col="red", width = 10, alpha = 0.8) +
geom_text(data = redDARplot_barReduction_plotdata %>%
select(combcat, excludeby, median_DR_reduction) %>%
unique
, aes(x = "Geriatry #1"
, y = median_DR_reduction
, label = paste0(round(median_DR_reduction*100), "%"))
, nudge_y = 0.05
, colour = "red"
, size = 3) +
# facet_grid(which_row~factor(combcat, levels = combcats), drop = T) +
facet_nested_wrap(.~excludeby + combcat, nrow = 2) +
theme_bw() +
theme(legend.background = element_rect(linetype = 1, size = 0.5, colour = 1)
, axis.text.x = element_text(angle = 45, hjust = 1)
# , axis.title.x = element_text(hjust = 0.1)
) +
guides(colour = F) +
theme(strip.background = element_rect(fill = NA)
, axis.text.x = element_text(size = 6)) +
scale_y_continuous(labels = function(x) scales::percent(x, accuracy = 1)) +
# scale_shape_manual(values = c(`Neonatal ICU`=15,`General paediatrics`=16,`Paediatric emergency`=17
#                               , `Adult ICU`=0,`Internal medicine`=1,`Adult emergency`=2
#                               , `Infectious diseases`=3,`Geriatry`=4,`Pneumology`=5)) +
# scale_shape_manual(values = c(`Neonatal ICU`=3,`General paediatrics`=5,`Paediatric emergency`=2
#                               , `Adult ICU`=0,`Internal medicine`=16,`Adult emergency`=4
#                               , `Infectious diseases`=1,`Geriatry`=15,`Pneumology`=17)) +
labs(y = "Reduction in number of secondary infections\nper day per infected individual"
# , x = "High risk individuals targeted by..."
, x = ""
# , caption = expression(frac(DAR[baseline]-DAR,DAR[baseline]))
# , shape = "Ward type"
) #+
redDARplot_barReduction
redDARplot_barReduction <- redDARplot_barReduction_plotdata %>%
ggplot() +
# geom_bar(aes(x = newID, y = DR_reduction), stat = "identity", position = position_dodge(width=0.8), width = 0.8) +
geom_segment(aes(x = newID, xend = newID, y = 0, yend = DR_reduction)) +
geom_point(aes(x = newID, y = DR_reduction)) +
geom_crossbar(data = redDARplot_barReduction_plotdata %>%
select(combcat, excludeby, median_DR_reduction) %>%
unique
, aes(x = "Geriatry #1"
, y = median_DR_reduction
, ymin = median_DR_reduction
, ymax = median_DR_reduction
), size=0.2,col="red", width = 10, alpha = 0.8) +
geom_text(data = redDARplot_barReduction_plotdata %>%
select(combcat, excludeby, median_DR_reduction) %>%
unique
, aes(x = "Geriatry #1"
, y = median_DR_reduction
, label = paste0(round(median_DR_reduction*100), "%"))
, nudge_y = 0.05
, colour = "red"
, size = 3) +
# facet_grid(which_row~factor(combcat, levels = combcats), drop = T) +
facet_nested_wrap(.~excludeby + combcat, nrow = 2) +
theme_bw() +
theme(legend.background = element_rect(linetype = 1, size = 0.5, colour = 1)
, axis.text.x = element_text(angle = 45, hjust = 1)
# , axis.title.x = element_text(hjust = 0.1)
) +
guides(colour = F) +
theme(strip.background = element_rect(fill = NA)
, axis.text.x = element_text(size = 6)) +
scale_y_continuous(labels = function(x) scales::percent(x, accuracy = 1)) +
# scale_shape_manual(values = c(`Neonatal ICU`=15,`General paediatrics`=16,`Paediatric emergency`=17
#                               , `Adult ICU`=0,`Internal medicine`=1,`Adult emergency`=2
#                               , `Infectious diseases`=3,`Geriatry`=4,`Pneumology`=5)) +
# scale_shape_manual(values = c(`Neonatal ICU`=3,`General paediatrics`=5,`Paediatric emergency`=2
#                               , `Adult ICU`=0,`Internal medicine`=16,`Adult emergency`=4
#                               , `Infectious diseases`=1,`Geriatry`=15,`Pneumology`=17)) +
labs(y = "Reduction in number of secondary infections\nper day per infected individual"
# , x = "High risk individuals targeted by..."
, x = ""
# , caption = expression(frac(DAR[baseline]-DAR,DAR[baseline]))
# , shape = "Ward type"
) #+
redDARplot_barReduction
# coord_cartesian(ylim = c(0, NA))
ggsave(plot = redDARplot_barReduction, "output/redDARplot_barReduction.pdf", device = "pdf"
, width = 30, height = 15, units = "cm")
ggsave(plot = redDARplot_barReduction, "output/redDARplot_barReduction.jpg", device = "jpeg"
, width = 30, height = 15, units = "cm", dpi = 600)
# coord_cartesian(ylim = c(0, NA))
ggsave(plot = redDARplot_barReduction, "output/redDARplot_barReduction.pdf", device = "pdf"
, width = 30, height = 15, units = "cm")
redDARplot_barReduction <- redDARplot_barReduction_plotdata %>%
ggplot() +
geom_bar(aes(x = newID, y = DR_reduction), stat = "identity", position = position_dodge(width=0.8), width = 0.5) +
# geom_segment(aes(x = newID, xend = newID, y = 0, yend = DR_reduction)) +
# geom_point(aes(x = newID, y = DR_reduction)) +
geom_crossbar(data = redDARplot_barReduction_plotdata %>%
select(combcat, excludeby, median_DR_reduction) %>%
unique
, aes(x = "Geriatry #1"
, y = median_DR_reduction
, ymin = median_DR_reduction
, ymax = median_DR_reduction
), size=0.2,col="red", width = 10, alpha = 0.8) +
geom_text(data = redDARplot_barReduction_plotdata %>%
select(combcat, excludeby, median_DR_reduction) %>%
unique
, aes(x = "Geriatry #1"
, y = median_DR_reduction
, label = paste0(round(median_DR_reduction*100), "%"))
, nudge_y = 0.05
, colour = "red"
, size = 3) +
# facet_grid(which_row~factor(combcat, levels = combcats), drop = T) +
facet_nested_wrap(.~excludeby + combcat, nrow = 2) +
theme_bw() +
theme(legend.background = element_rect(linetype = 1, size = 0.5, colour = 1)
, axis.text.x = element_text(angle = 45, hjust = 1)
# , axis.title.x = element_text(hjust = 0.1)
) +
guides(colour = F) +
theme(strip.background = element_rect(fill = NA)
, axis.text.x = element_text(size = 6)) +
scale_y_continuous(labels = function(x) scales::percent(x, accuracy = 1)) +
# scale_shape_manual(values = c(`Neonatal ICU`=15,`General paediatrics`=16,`Paediatric emergency`=17
#                               , `Adult ICU`=0,`Internal medicine`=1,`Adult emergency`=2
#                               , `Infectious diseases`=3,`Geriatry`=4,`Pneumology`=5)) +
# scale_shape_manual(values = c(`Neonatal ICU`=3,`General paediatrics`=5,`Paediatric emergency`=2
#                               , `Adult ICU`=0,`Internal medicine`=16,`Adult emergency`=4
#                               , `Infectious diseases`=1,`Geriatry`=15,`Pneumology`=17)) +
labs(y = "Reduction in number of secondary infections\nper day per infected individual"
# , x = "High risk individuals targeted by..."
, x = ""
# , caption = expression(frac(DAR[baseline]-DAR,DAR[baseline]))
# , shape = "Ward type"
) #+
redDARplot_barReduction
# coord_cartesian(ylim = c(0, NA))
ggsave(plot = redDARplot_barReduction, "output/redDARplot_barReduction.pdf", device = "pdf"
, width = 30, height = 15, units = "cm")
ggsave(plot = redDARplot_barReduction, "output/redDARplot_barReduction.jpg", device = "jpeg"
, width = 30, height = 15, units = "cm", dpi = 600)
redDARplot_barReduction <- redDARplot_barReduction_plotdata %>%
ggplot() +
geom_bar(aes(x = newID, y = DR_reduction), stat = "identity", position = position_dodge(width=0.8), width = 0.2) +
# geom_segment(aes(x = newID, xend = newID, y = 0, yend = DR_reduction)) +
# geom_point(aes(x = newID, y = DR_reduction)) +
geom_crossbar(data = redDARplot_barReduction_plotdata %>%
select(combcat, excludeby, median_DR_reduction) %>%
unique
, aes(x = "Geriatry #1"
, y = median_DR_reduction
, ymin = median_DR_reduction
, ymax = median_DR_reduction
), size=0.2,col="red", width = 10, alpha = 0.8) +
geom_text(data = redDARplot_barReduction_plotdata %>%
select(combcat, excludeby, median_DR_reduction) %>%
unique
, aes(x = "Geriatry #1"
, y = median_DR_reduction
, label = paste0(round(median_DR_reduction*100), "%"))
, nudge_y = 0.05
, colour = "red"
, size = 3) +
# facet_grid(which_row~factor(combcat, levels = combcats), drop = T) +
facet_nested_wrap(.~excludeby + combcat, nrow = 2) +
theme_bw() +
theme(legend.background = element_rect(linetype = 1, size = 0.5, colour = 1)
, axis.text.x = element_text(angle = 45, hjust = 1)
# , axis.title.x = element_text(hjust = 0.1)
) +
guides(colour = F) +
theme(strip.background = element_rect(fill = NA)
, axis.text.x = element_text(size = 6)) +
scale_y_continuous(labels = function(x) scales::percent(x, accuracy = 1)) +
# scale_shape_manual(values = c(`Neonatal ICU`=15,`General paediatrics`=16,`Paediatric emergency`=17
#                               , `Adult ICU`=0,`Internal medicine`=1,`Adult emergency`=2
#                               , `Infectious diseases`=3,`Geriatry`=4,`Pneumology`=5)) +
# scale_shape_manual(values = c(`Neonatal ICU`=3,`General paediatrics`=5,`Paediatric emergency`=2
#                               , `Adult ICU`=0,`Internal medicine`=16,`Adult emergency`=4
#                               , `Infectious diseases`=1,`Geriatry`=15,`Pneumology`=17)) +
labs(y = "Reduction in number of secondary infections\nper day per infected individual"
# , x = "High risk individuals targeted by..."
, x = ""
# , caption = expression(frac(DAR[baseline]-DAR,DAR[baseline]))
# , shape = "Ward type"
) #+
redDARplot_barReduction
# coord_cartesian(ylim = c(0, NA))
ggsave(plot = redDARplot_barReduction, "output/redDARplot_barReduction.pdf", device = "pdf"
, width = 30, height = 15, units = "cm")
# coord_cartesian(ylim = c(0, NA))
ggsave(plot = redDARplot_barReduction, "output/redDARplot_barReduction.pdf", device = "pdf"
, width = 30, height = 15, units = "cm")
ggsave(plot = redDARplot_barReduction, "output/redDARplot_barReduction.jpg", device = "jpeg"
, width = 30, height = 15, units = "cm", dpi = 600)
redDARplot_barReduction <- redDARplot_barReduction_plotdata %>%
ggplot() +
geom_bar(aes(x = newID, y = DR_reduction), stat = "identity", position = position_dodge(width=0.8), width = 0.2) +
# geom_segment(aes(x = newID, xend = newID, y = 0, yend = DR_reduction)) +
# geom_point(aes(x = newID, y = DR_reduction)) +
geom_crossbar(data = redDARplot_barReduction_plotdata %>%
select(combcat, excludeby, median_DR_reduction) %>%
unique
, aes(x = "Geriatry #1"
, y = median_DR_reduction
, ymin = median_DR_reduction
, ymax = median_DR_reduction
), size=0.2,col="red", width = 10, alpha = 0.8) +
geom_text(data = redDARplot_barReduction_plotdata %>%
select(combcat, excludeby, median_DR_reduction) %>%
unique
, aes(x = "Geriatry #1"
, y = median_DR_reduction
, label = paste0(round(median_DR_reduction*100), "%"))
, nudge_y = 0.05
, colour = "red"
, size = 3) +
# facet_grid(which_row~factor(combcat, levels = combcats), drop = T) +
facet_nested_wrap(.~excludeby + combcat, nrow = 2) +
theme_bw() +
theme(legend.background = element_rect(linetype = 1, size = 0.5, colour = 1)
, axis.text.x = element_text(angle = 45, hjust = 1)
# , axis.title.x = element_text(hjust = 0.1)
) +
guides(colour = F) +
theme(strip.background = element_rect(fill = NA)
, axis.text.x = element_text(size = 6)
, panel.grid.major.x = element_blank()) +
scale_y_continuous(labels = function(x) scales::percent(x, accuracy = 1)) +
# scale_shape_manual(values = c(`Neonatal ICU`=15,`General paediatrics`=16,`Paediatric emergency`=17
#                               , `Adult ICU`=0,`Internal medicine`=1,`Adult emergency`=2
#                               , `Infectious diseases`=3,`Geriatry`=4,`Pneumology`=5)) +
# scale_shape_manual(values = c(`Neonatal ICU`=3,`General paediatrics`=5,`Paediatric emergency`=2
#                               , `Adult ICU`=0,`Internal medicine`=16,`Adult emergency`=4
#                               , `Infectious diseases`=1,`Geriatry`=15,`Pneumology`=17)) +
labs(y = "Reduction in number of secondary infections\nper day per infected individual"
# , x = "High risk individuals targeted by..."
, x = ""
# , caption = expression(frac(DAR[baseline]-DAR,DAR[baseline]))
# , shape = "Ward type"
) #+
redDARplot_barReduction
# coord_cartesian(ylim = c(0, NA))
ggsave(plot = redDARplot_barReduction, "output/redDARplot_barReduction.pdf", device = "pdf"
, width = 30, height = 15, units = "cm")
ggsave(plot = redDARplot_barReduction, "output/redDARplot_barReduction.jpg", device = "jpeg"
, width = 30, height = 15, units = "cm", dpi = 600)
